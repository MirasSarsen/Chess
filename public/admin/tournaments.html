<!DOCTYPE html>
<html lang="ru">

<head>
    <link rel="stylesheet" href="/admin/styles.css" />
    <meta charset="UTF-8" />
    <title>–†–µ–¥–∞–∫—Ç–æ—Ä –¢—É—Ä–Ω–∏—Ä–æ–≤</title>
</head>

<body>
    <div class="admin-nav">
        <a href="/admin/index.html" class="admin-link">–†–µ–¥–∞–∫—Ç–æ—Ä –ì–ª–∞–≤–Ω–æ–π</a>
        <a href="/admin/schedule.html" class="admin-link">–†–µ–¥–∞–∫—Ç–æ—Ä –†–∞—Å–ø–∏—Å–∞–Ω–∏—è</a>
        <a href="/admin/students.html" class="admin-link">–†–µ–¥–∞–∫—Ç–æ—Ä –£—á–µ–Ω–∏–∫–æ–≤</a>
        <a href="/admin/tournaments.html" class="admin-link">–†–µ–¥–∞–∫—Ç–æ—Ä –¢—É—Ä–Ω–∏—Ä–æ–≤</a>
    </div>

    <h1>–†–µ–¥–∞–∫—Ç–æ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã ¬´–¢—É—Ä–Ω–∏—Ä—ã¬ª</h1>
    <form id="tournamentForm">
        <h2>Hero</h2>
        <input name="hero.title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫" />
        <input name="hero.subtitle" placeholder="–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫" />
        <input name="hero.buttonText" placeholder="–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏" />

        <h2>–¢—É—Ä–Ω–∏—Ä—ã</h2>
        <div id="tournamentList"></div>
        <button type="button" onclick="addTournament()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç—É—Ä–Ω–∏—Ä</button>

        <br><br>
        <button type="submit">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </form>

    <script>
        const form = document.getElementById("tournamentForm");
        const tournamentList = document.getElementById("tournamentList");

        function createTournamentBlock({ name = "", date = "", level = "", location = "", format = "" } = {}) {
            const index = tournamentList.children.length;
            const div = document.createElement("div");
            div.className = "tournament-block";
            div.innerHTML = `
        <button type="button" class="remove-btn" onclick="this.parentElement.remove()">‚úñ</button>
        <input name="name${index}" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞" value="${name}" />
        <input name="date${index}" placeholder="–î–∞—Ç–∞" value="${date}" />
        <input name="level${index}" placeholder="–£—Ä–æ–≤–µ–Ω—å" value="${level}" />
        <input name="location${index}" placeholder="–ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" value="${location}" />
        <input name="format${index}" placeholder="–§–æ—Ä–º–∞—Ç (–û–Ω–ª–∞–π–Ω/–û—Ñ—Ñ–ª–∞–π–Ω, –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" value="${format}" />
      `;
            tournamentList.appendChild(div);
        }

        function addTournament() {
            createTournamentBlock();
        }

        async function loadContent() {
            const res = await fetch("/api/content/tournaments");
            const data = await res.json();

            form.querySelector('[name="hero.title"]').value = data.hero.title;
            form.querySelector('[name="hero.subtitle"]').value = data.hero.subtitle;
            form.querySelector('[name="hero.buttonText"]').value = data.hero.buttonText;

            tournamentList.innerHTML = "";
            data.list.forEach(t => createTournamentBlock(t));
        }

        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            const formData = new FormData(form);

            const blocks = tournamentList.querySelectorAll(".tournament-block");
            const list = [];

            blocks.forEach((block, i) => {
                const name = block.querySelector(`[name="name${i}"]`)?.value || "";
                const date = block.querySelector(`[name="date${i}"]`)?.value || "";
                const level = block.querySelector(`[name="level${i}"]`)?.value || "";
                const location = block.querySelector(`[name="location${i}"]`)?.value || "";
                const format = block.querySelector(`[name="format${i}"]`)?.value || "";
                if (name && date) {
                    list.push({ name, date, level, location, format });
                }
            });

            const data = {
                hero: {
                    title: formData.get("hero.title"),
                    subtitle: formData.get("hero.subtitle"),
                    buttonText: formData.get("hero.buttonText")
                },
                list
            };

            await fetch("/api/content/tournaments", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });

            alert("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!");
        });

        loadContent();
    </script>
</body>

</html>
